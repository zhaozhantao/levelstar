require=function t(e,r,i){function a(o,n){if(!r[o]){if(!e[o]){var s="function"==typeof require&&require;if(!n&&s)return s(o,!0);if(c)return c(o,!0);var l=new Error("Cannot find module '"+o+"'");throw l.code="MODULE_NOT_FOUND",l}var h=r[o]={exports:{}};e[o][0].call(h.exports,function(t){var r=e[o][1][t];return a(r?r:t)},h,h.exports,t,e,r,i)}return r[o].exports}for(var c="function"==typeof require&&require,o=0;o<i.length;o++)a(i[o]);return a}({Comm:[function(t,e,r){"use strict";cc._RF.push(e,"1d260IA5QhB5Lx5Sb8wIrja","Comm");var i=t("./prefab/TipPrefab.js"),a=t("./prefab/ConfirmDialogPrefab.js");e.exports={gridSize:10,calcClearScore:function(t){return t*t*5},calcLastScore:function(t){return Math.max(0,2e3-t*t*20)},tip:function(t){console.log("tip"),cc.loader.loadRes("prefab/TipPrefab",function(e,r){if(e)return void console.log(e);var a=cc.instantiate(r);cc.director.getScene().addChild(a),a.getComponent(i).show(t)})},confirm:function(t,e,r,i,c,o){console.log("confirm"),cc.loader.loadRes("prefab/ConfirmDialogPrefab",function(n,s){if(n)return void console.log(n);var l=cc.instantiate(s);cc.director.getScene().addChild(l),l.getComponent(a).show(t,e,r,i,c,o)})},readLevelScores:function(){var t=cc.sys.localStorage.getItem("LEVEL_SCORES");t?this.levelScores=JSON.parse(t):this.levelScores={}},saveLevelScores:function(){var t=JSON.stringify(this.levelScores);cc.sys.localStorage.setItem("LEVEL_SCORES",t)},calcScoreLogic:function(){this.totalScore=0,this.minScoreLevel=0,this.min2ScoreLevel=0;for(var t in this.levelScores){var e=this.levelScores[t];this.totalScore+=e}var r=0;for(console.log(this.totalScore,this.calcTargetScore(r));this.totalScore>=this.calcTargetScore(r);)r++;this.maxLevel=r;for(var i=Number.POSITIVE_INFINITY,a=Number.POSITIVE_INFINITY,t=1;t<=this.maxLevel;t++){var e=this.levelScores[t.toString()];e||(e=0),e<i||e==i&&this.minScoreLevel>t?(i=e,this.min2ScoreLevel=this.minScoreLevel,this.minScoreLevel=t):(e<a||e==a&&this.min2ScoreLevel>t)&&(a=e,this.min2ScoreLevel=t)}},calcTargetScore:function(t){if(this.levelCfg||(this.levelCfg={}),this.levelCfg[t.toString()])return this.levelCfg[t.toString()];var e=1e3;return t>1?(e=this.calcTargetScore(t-1),e+=0==e%2?2e3:3e3,e+=300*Math.floor(t/10)):0==t&&(e=0),this.levelCfg[t.toString()]=e,e},setLevelScore:function(t,e){console.log("setLevelScore",t,e),this.levelScores[t.toString()]=e},calcTargetStr:function(){this.targetStrTab={};var t=0;this.min2ScoreLevel&&0!=this.min2ScoreLevel&&(t=this.levelScores[this.min2ScoreLevel],t?t++:t=0);var e=0;if(this.maxLevel){var r=this.levelScores[this.currentLevel];r||(r=0),e=this.calcTargetScore(this.maxLevel)-(this.totalScore-r)}t>e?e>0?(this.targetStrTab.littleTarget=e,this.targetStrTab.littleTargetStr="(解锁第"+(this.maxLevel+1)+"关)\n",this.targetStrTab.bigTarget=t,this.targetStrTab.bigTargetStr="(超过第"+this.min2ScoreLevel+"关)"):(this.targetStrTab.oneTarget=t,this.targetStrTab.oneTargetStr="(超过第"+this.min2ScoreLevel+"关)"):t>0?(this.targetStrTab.littleTarget=t,this.targetStrTab.littleTargetStr="(超过第"+this.min2ScoreLevel+"关)",this.targetStrTab.bigTarget=e,this.targetStrTab.bigTargetStr="(解锁第"+(this.maxLevel+1)+"关)\n"):(this.targetStrTab.oneTarget=e,this.targetStrTab.oneTargetStr="(解锁第"+(this.maxLevel+1)+"关)\n")}},cc._RF.pop()},{"./prefab/ConfirmDialogPrefab.js":"ConfirmDialogPrefab","./prefab/TipPrefab.js":"TipPrefab"}],ConfirmDialogPrefab:[function(t,e,r){"use strict";cc._RF.push(e,"c7199ySzr1IhI7NQxciQpOR","ConfirmDialogPrefab"),cc.Class({"extends":cc.Component,properties:{titleLabel:cc.Label,contentLabel:cc.Label,btn1Node:cc.Node,btn2Node:cc.Node,btn1Label:cc.Label,btn2Label:cc.Label},show:function(t,e,r,i,a,c){this.titleLabel.string=t,this.contentLabel.string=e,this.btn1Label.string=r,this.btn1Cb=i,a?(this.btn2Label.string=a,this.btn2Cb=c):(this.btn1Node.x=0,this.btn2Node.active=!1)},btn1Click:function(){this.btn1Cb(),this.node.destroy()},btn2Click:function(){this.btn2Cb(),this.node.destroy()},fullScreenBtnClick:function(){console.log("fullScreenBtnClick")},dialogBtnClick:function(){console.log("dialogBtnClick")}}),cc._RF.pop()},{}],GameScene:[function(t,e,r){"use strict";cc._RF.push(e,"e3996EcHbNIBo8DcXtt3l87","GameScene");var i=t("../prefab/StarPrefab.js"),a=t("../Comm.js");cc.Class({"extends":cc.Component,properties:{starPrefab:cc.Prefab,starGrid:cc.Node,scoreLabel:cc.Label,scorePreLabel:cc.Label,targetLabel:cc.Label},onLoad:function(){var t=this;this.starGame(),this.starGrid.on(cc.Node.EventType.TOUCH_START,function(e){var r=t.starGrid.convertToNodeSpace(e.touch.getLocation());t.touchStar(parseInt(r.x/(t.starGrid.width/10)),parseInt(r.y/(t.starGrid.height/10)))});var e=cc.director.getWinSize();this.scoreLabel.node.y=e.height/2-(e.height-e.width)/2/2,this.targetLabel.node.y=e.height/2-50},starGame:function(){this.initStatus(),this.initGrid(),a.calcTargetStr(),this.targetButtonClick(),this.updateTargetLabel()},initStatus:function(){this.stVar={},this.stVar.selected=!1,this.totalScore=0},initGrid:function(){if(this.gridStarUi)for(var t=0;t<a.gridSize;t++)for(var e=0;e<a.gridSize;e++)this.gridStarUi[t][e]&&this.gridStarUi[t][e].destroy();for(var r=[],c=[],o=0;o<a.gridSize;o++){r[o]=[],c[o]=[];for(var n=0;n<a.gridSize;n++){var s=cc.instantiate(this.starPrefab),l=s.getComponent(i);s.parent=this.starGrid,l.setGridXY(o,n);var h=parseInt(5*Math.random()+1);l.setType(h),r[o][n]=h,c[o][n]=s}}this.gridData=r,this.gridStarUi=c},updateTargetLabel:function(){a.targetStrTab.oneTarget?this.totalScore>=a.targetStrTab.oneTarget?this.targetLabel.string="目标:"+a.targetStrTab.oneTarget+"分(已完成)":this.targetLabel.string="目标:"+a.targetStrTab.oneTarget+"分":this.totalScore<a.targetStrTab.littleTarget?this.targetLabel.string="小目标:"+a.targetStrTab.littleTarget+"分":this.totalScore<a.targetStrTab.bigTarget?this.targetLabel.string="大目标:"+a.targetStrTab.bigTarget+"分":this.targetLabel.string="大目标:"+a.targetStrTab.bigTarget+"分(已完成)"},touchStar:function(t,e){if(this.stVar.selected)this.connectContain(t,e)?(this.cleanOnce(t,e),this.stVar.selected=!1):(this.setConnectStarSelect(!1),this.scorePreLabel.node.active=!1,this.touchStar(t,e));else{if(0==this.gridData[t][e])return;this.stVar.connectStars=[[t,e]],this.checkStar(t,e),this.stVar.connectStars.length>=2&&(this.setConnectStarSelect(!0),this.scorePreLabel.string=a.calcClearScore(this.stVar.connectStars.length),this.scorePreLabel.node.stopAllActions(),this.scorePreLabel.node.setPosition(this.gridStarUi[t][e].position),this.scorePreLabel.node.opacity=255,this.scorePreLabel.fontSize=32,this.scorePreLabel.node.active=!0)}},checkStar:function(t,e){for(var r=this.gridData[t][e],i=[[t+1,e],[t-1,e],[t,e-1],[t,e+1]],a=i.length-1;a>=0;a--){i[a];var c=i[a][0],o=i[a][1];this.inGrid(c,o)&&this.gridData[c][o]==r&&!this.connectContain(c,o)&&(this.stVar.connectStars[this.stVar.connectStars.length]=[c,o],this.checkStar(c,o))}},inGrid:function(t,e){return t>=0&&t<a.gridSize&&e>=0&&e<a.gridSize},connectContain:function(t,e){for(var r=this.stVar.connectStars.length-1;r>=0;r--){var i=this.stVar.connectStars[r];if(i[0]==t&&i[1]==e)return!0}return!1},setConnectStarSelect:function(t){for(var e=this.stVar.connectStars.length-1;e>=0;e--){var r=this.stVar.connectStars[e];this.gridStarUi[r[0]][r[1]].getComponent(i).setSelected(t)}this.stVar.selected=t},cleanOnce:function(){if(this.scorePreLabel.fontSize=64,this.scorePreLabel.node.runAction(cc.sequence(cc.moveBy(.2,cc.p(0,20)),cc.delayTime(.8),cc.spawn(cc.moveBy(.2,cc.p(0,10)),cc.fadeOut(.2)))),this.totalScore+=parseInt(this.scorePreLabel.string),this.scoreLabel.string=this.totalScore,this.updateTargetLabel(),this.clearConnectStar(),this.fallDownStar(),this.fallLeftStar(),this.checkOver()){console.log("不能再消除了");var t=this.checkCount(),e=a.calcLastScore(t);this.totalScore+=e,this.scoreLabel.string=this.totalScore,console.log("计算剩余星星分"),console.log("最终得分",this.totalScore);var r="";if(a.targetStrTab.oneTarget){var i="已完成";this.totalScore<a.targetStrTab.oneTarget&&(i="未完成"),r="目标:"+a.targetStrTab.oneTarget+"分"+a.targetStrTab.oneTargetStr+i}else{var c="已完成";this.totalScore<a.targetStrTab.littleTarget&&(c="未完成");var o="已完成";this.totalScore<a.targetStrTab.bigTarget&&(o="未完成"),r="小目标:"+a.targetStrTab.littleTarget+"分"+a.targetStrTab.littleTargetStr+c+"\n大目标:"+a.targetStrTab.bigTarget+"分"+a.targetStrTab.bigTargetStr+o}var n=a.levelScores[a.currentLevel.toString()];(!n||this.totalScore>n)&&(console.log("破记录了"),a.setLevelScore(a.currentLevel,this.totalScore),a.saveLevelScores(),a.calcScoreLogic()),a.confirm("不能再消除了","您的得分:"+this.totalScore+"(其中剩余星星"+t+"附加分:"+e+")","确定",function(){a.confirm("目标",r,"回主菜单",function(){cc.director.loadScene("MainScene")})})}},clearConnectStar:function(){for(var t=this.stVar.connectStars.length-1;t>=0;t--){var e=this.stVar.connectStars[t];this.gridData[e[0]][e[1]]=0,this.gridStarUi[e[0]][e[1]].destroy()}},fallDownStar:function(){for(var t=0;t<a.gridSize;t++)for(var e=0,r=0;r<a.gridSize;r++)0==this.gridData[t][r]&&e++,e>0&&this.gridData[t][r]>0&&(this.gridData[t][r-e]=this.gridData[t][r],this.gridData[t][r]=0,this.gridStarUi[t][r].getComponent(i).goTo(t,r-e,0),this.gridStarUi[t][r-e]=this.gridStarUi[t][r],this.gridStarUi[t][r]=null)},fallLeftStar:function(){for(var t=0,e=0;e<a.gridSize;e++)if(0==this.gridData[e][0]&&t++,0!=this.gridData[e][0]&&0!=t)for(var r=0;r<a.gridSize&&this.gridData[e][r]>0;r++)this.gridData[e-t][r]=this.gridData[e][r],this.gridData[e][r]=0,this.gridStarUi[e][r].getComponent(i).goTo(e-t,r,.1),this.gridStarUi[e-t][r]=this.gridStarUi[e][r],this.gridStarUi[e][r]=null},checkOver:function(){for(var t=0;t<a.gridSize;t++)for(var e=0;e<a.gridSize;e++){var r=this.gridData[t][e];if(0==r)break;for(var i=[[t+1,e],[t-1,e],[t,e-1],[t,e+1]],c=0;c<i.length;c++){var o=i[c][0],n=i[c][1];if(this.inGrid(o,n)&&this.gridData[o][n]==r)return!1}}return!0},checkCount:function(){for(var t=0,e=0;e<a.gridSize;e++)for(var r=0;r<a.gridSize;r++){var i=this.gridData[e][r];i>0&&t++}return t},targetButtonClick:function(){var t="";t=a.targetStrTab.oneTarget?"目标:"+a.targetStrTab.oneTarget+"分"+a.targetStrTab.oneTargetStr:"小目标:"+a.targetStrTab.littleTarget+"分"+a.targetStrTab.littleTargetStr+"\n大目标:"+a.targetStrTab.bigTarget+"分"+a.targetStrTab.bigTargetStr,console.log(t),a.confirm("目标",t,"确定",function(){})}}),cc._RF.pop()},{"../Comm.js":"Comm","../prefab/StarPrefab.js":"StarPrefab"}],LevelCurPrefab:[function(t,e,r){"use strict";cc._RF.push(e,"046c9RjCshG748pEaUzb9At","LevelCurPrefab");var i=t("../Comm.js");cc.Class({"extends":cc.Component,properties:{strLabel:cc.Label},setLevel:function(t){this.level=t;var e=i.levelScores[t.toString()];e||(e=0),this.strLabel.string="第"+t+"关 "+e+"分"},mainButtonClick:function(){this.cb(this.level)},setClickCallback:function(t){this.cb=t}}),cc._RF.pop()},{"../Comm.js":"Comm"}],LevelPrefab:[function(t,e,r){"use strict";cc._RF.push(e,"5c0b0KWY05MQIxdXOuvrjyk","LevelPrefab");var i=t("../Comm.js");cc.Class({"extends":cc.Component,properties:{strLabel:cc.Label,lock:cc.Node},setLevel:function(t){this.level=t;var e=i.levelScores[t.toString()];e||(e=0),this.strLabel.string="第"+t+"关 "+e+"分",this.lock.active=!1},setUnlockInfoForLevel:function(t){this.level=t,this.strLabel.string="总分"+i.calcTargetScore(this.level-1)+"解锁第"+t+"关",this.lock.active=!0},mainButtonClick:function(){this.cb(this.level)},setClickCallback:function(t){this.cb=t}}),cc._RF.pop()},{"../Comm.js":"Comm"}],MainScene:[function(t,e,r){"use strict";cc._RF.push(e,"04fb30nHQBA7J6o6i9uMytG","MainScene");var i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},a=t("../Comm.js"),c=t("../prefab/LevelPrefab.js"),o=t("../prefab/LevelCurPrefab.js");cc.Class({"extends":cc.Component,properties:{levelLayout:cc.Node,levelPrefab:cc.Prefab,levelCurPrefab:cc.Prefab,totalScoreLabel:cc.Label,scrollView:cc.ScrollView},onLoad:function(){a.readLevelScores(),a.calcScoreLogic(),this.totalScoreLabel.string="总分:"+a.totalScore;for(var t=1;t<a.minScoreLevel;t++){var e=cc.instantiate(this.levelPrefab);e.getComponent(c).setLevel(t),e.getComponent(c).setClickCallback(function(t){a.currentLevel=t,console.log("Comm.currentLevel",a.currentLevel),cc.director.loadScene("GameScene")}),this.levelLayout.addChild(e)}var e=cc.instantiate(this.levelCurPrefab);e.getComponent(o).setLevel(a.minScoreLevel),e.getComponent(o).setClickCallback(function(t){a.currentLevel=a.minScoreLevel,console.log("Comm.currentLevel",a.currentLevel),cc.director.loadScene("GameScene")}),this.levelLayout.addChild(e);for(var t=a.minScoreLevel+1;t<=a.maxLevel;t++){var e=cc.instantiate(this.levelPrefab);e.getComponent(c).setLevel(t),e.getComponent(c).setClickCallback(function(t){a.currentLevel=t,console.log("Comm.currentLevel",a.currentLevel),cc.director.loadScene("GameScene")}),this.levelLayout.addChild(e)}var e=cc.instantiate(this.levelPrefab);if(e.getComponent(c).setUnlockInfoForLevel(a.maxLevel+1),e.getComponent(c).setClickCallback(function(t){a.tip("总分达到"+a.calcTargetScore(t-1)+"才能玩这一关")}),this.levelLayout.addChild(e),this.scheduleOnce(function(){var t=this.scrollView.getMaxScrollOffset(),e=Math.min(1,Math.max(0,(a.minScoreLevel-6)/(a.maxLevel+1-7)));console.log("percent",e),this.scrollView.scrollToOffset(cc.p(0,t.y*e),.3)},0),console.log("弄一下统计的东西"),console.log("typeof","undefined"==typeof anysdk?"undefined":i(anysdk)),"undefined"!=typeof anysdk){var r=anysdk.agentManager;if(console.log("agent",r),r){var n=r.getAnalyticsPlugin();console.log("user_plugin",n),n&&(n.setAccount&&n.setAccount({Account_Id:"123456",Account_Name:"test",Account_Type:anysdk.AccountType.ANONYMOUS.toString(),Account_Level:"0",Account_Age:"0",Account_Operate:anysdk.AccountOperate.LOGIN.toString(),Account_Gender:anysdk.AccountGender.UNKNOWN.toString(),Server_Id:"0"}),n.startSession&&n.startSession(),console.log("统计的东西弄完了"))}}},startButtonClick:function(){}}),cc._RF.pop()},{"../Comm.js":"Comm","../prefab/LevelCurPrefab.js":"LevelCurPrefab","../prefab/LevelPrefab.js":"LevelPrefab"}],StarPrefab:[function(t,e,r){"use strict";cc._RF.push(e,"22bb0VNWAxF/ZMJwZXVIaIx","StarPrefab"),cc.Class({"extends":cc.Component,properties:{pic1:cc.SpriteFrame,pic2:cc.SpriteFrame,pic3:cc.SpriteFrame,pic4:cc.SpriteFrame,pic5:cc.SpriteFrame},onLoad:function(){this.node.setScale(1.17)},setType:function(t){this.starType=t,this.getComponent(cc.Sprite).spriteFrame=this["pic"+t]},setGridXY:function(t,e){this.gridX=t,this.gridY=e,this.node.setPosition(75*(t-5)+37.5,75*(e-5)+37.5)},setSelected:function(t){t?this.node.runAction(cc.repeatForever(cc.sequence(cc.scaleTo(.3,1),cc.scaleTo(.3,1.17)))):(this.node.stopAllActions(),this.node.setScale(1.17))},goTo:function(t,e,r){this.gridX=t,this.gridY=e,this.node.runAction(cc.sequence(cc.delayTime(r),cc.moveTo(.1,cc.p(75*(t-5)+37.5,75*(e-5)+37.5))))}}),cc._RF.pop()},{}],TipPrefab:[function(t,e,r){"use strict";cc._RF.push(e,"2fc39ba/flCCaXZ48+4ZaMH","TipPrefab"),cc.Class({"extends":cc.Component,properties:{tipLabel:cc.Label,tipBg:cc.Node},show:function(t){var e=this;this.tipLabel.string=t,this.node.setPosition(cc.director.getWinSize().width/2,100),this.node.runAction(cc.sequence(cc.delayTime(2),cc.fadeOut(.3),cc.callFunc(function(){e.node.destroy()})))}}),cc._RF.pop()},{}]},{},["Comm","ConfirmDialogPrefab","LevelCurPrefab","LevelPrefab","StarPrefab","TipPrefab","GameScene","MainScene"]);