require=function e(t,r,c){function i(n,a){if(!r[n]){if(!t[n]){var s="function"==typeof require&&require;if(!a&&s)return s(n,!0);if(o)return o(n,!0);var l=new Error("Cannot find module '"+n+"'");throw l.code="MODULE_NOT_FOUND",l}var h=r[n]={exports:{}};t[n][0].call(h.exports,function(e){var r=t[n][1][e];return i(r?r:e)},h,h.exports,e,t,r,c)}return r[n].exports}for(var o="function"==typeof require&&require,n=0;n<c.length;n++)i(c[n]);return i}({Comm:[function(e,t,r){"use strict";cc._RF.push(t,"1d260IA5QhB5Lx5Sb8wIrja","Comm");var c=e("./prefab/TipPrefab.js"),i=e("./prefab/ConfirmDialogPrefab.js");t.exports={gridSize:10,calcClearScore:function(e){return e*e*5},calcLastScore:function(e){return math.max(0,2e3-e*e*20)},tip:function(e){console.log("tip"),cc.loader.loadRes("prefab/TipPrefab",function(t,r){if(t)return void console.log(t);var i=cc.instantiate(r);cc.director.getScene().addChild(i),i.getComponent(c).show(e)})},confirm:function(e,t,r,c,o,n){console.log("confirm"),cc.loader.loadRes("prefab/ConfirmDialogPrefab",function(a,s){if(a)return void console.log(a);var l=cc.instantiate(s);cc.director.getScene().addChild(l),l.getComponent(i).show(e,t,r,c,o,n)})},readLevelScores:function(){var e=cc.sys.localStorage.getItem("LEVEL_SCORES");e?this.levelScores=JSON.parse(e):this.levelScores={}},saveLevelScores:function(){var e=JSON.stringify(this.levelScores);cc.sys.localStorage.setItem("LEVEL_SCORES",e)},calcScoreLogic:function(){this.totalScore=0,this.minLockLevel=10,this.minScoreLevel=0;for(var e in this.levelScores){var t=this.levelScores[e];this.totalScore+=t}var r=0;for(console.log(this.totalScore,this.calcTargetScore(r));this.totalScore>=this.calcTargetScore(r);)r++;this.maxLevel=r;for(var c=Number.POSITIVE_INFINITY,e=1;e<=this.maxLevel;e++){var t=this.levelScores[e.toString()];t||(t=0),(t<c||t==c&&this.minScoreLevel>e)&&(c=t,this.minScoreLevel=e)}},calcTargetScore:function(e){if(this.levelCfg||(this.levelCfg={}),this.levelCfg[e.toString()])return this.levelCfg[e.toString()];var t=1e3;return e>1?(t=this.calcTargetScore(e-1),t+=0==t%2?2e3:3e3,t+=300*Math.floor(e/10)):0==e&&(t=0),this.levelCfg[e.toString()]=t,t},setLevelScore:function(e,t){console.log("setLevelScore",e,t),this.levelScores[e.toString()]=t}},cc._RF.pop()},{"./prefab/ConfirmDialogPrefab.js":"ConfirmDialogPrefab","./prefab/TipPrefab.js":"TipPrefab"}],ConfirmDialogPrefab:[function(e,t,r){"use strict";cc._RF.push(t,"c7199ySzr1IhI7NQxciQpOR","ConfirmDialogPrefab"),cc.Class({"extends":cc.Component,properties:{titleLabel:cc.Label,contentLabel:cc.Label,btn1Node:cc.Node,btn2Node:cc.Node,btn1Label:cc.Label,btn2Label:cc.Label},show:function(e,t,r,c,i,o){this.titleLabel.string=e,this.contentLabel.string=t,this.btn1Label.string=r,this.btn1Cb=c,i?(this.btn2Label.string=i,this.btn2Cb=o):(this.btn1Node.x=0,this.btn2Node.active=!1)},btn1Click:function(){this.btn1Cb(),this.node.destroy()},btn2Click:function(){this.btn2Cb(),this.node.destroy()},fullScreenBtnClick:function(){console.log("fullScreenBtnClick")},dialogBtnClick:function(){console.log("dialogBtnClick")}}),cc._RF.pop()},{}],GameScene:[function(e,t,r){"use strict";cc._RF.push(t,"e3996EcHbNIBo8DcXtt3l87","GameScene");var c=e("../prefab/StarPrefab.js"),i=e("../Comm.js");cc.Class({"extends":cc.Component,properties:{starPrefab:cc.Prefab,starGrid:cc.Node,scoreLabel:cc.Label,scorePreLabel:cc.Label},onLoad:function(){var e=this;this.starGame(),this.starGrid.on(cc.Node.EventType.TOUCH_START,function(t){var r=e.starGrid.convertToNodeSpace(t.touch.getLocation());e.touchStar(parseInt(r.x/(e.starGrid.width/10)),parseInt(r.y/(e.starGrid.height/10)))})},starGame:function(){this.initStatus(),this.initGrid()},initStatus:function(){this.stVar={},this.stVar.selected=!1,this.totalScore=0},initGrid:function(){if(this.gridStarUi)for(var e=0;e<i.gridSize;e++)for(var t=0;t<i.gridSize;t++)this.gridStarUi[e][t]&&this.gridStarUi[e][t].destroy();for(var r=[],o=[],n=0;n<i.gridSize;n++){r[n]=[],o[n]=[];for(var a=0;a<i.gridSize;a++){var s=cc.instantiate(this.starPrefab),l=s.getComponent(c);s.parent=this.starGrid,l.setGridXY(n,a);var h=parseInt(5*Math.random()+1);l.setType(h),r[n][a]=h,o[n][a]=s}}this.gridData=r,this.gridStarUi=o},touchStar:function(e,t){if(this.stVar.selected)this.connectContain(e,t)?(this.cleanOnce(e,t),this.stVar.selected=!1):(this.setConnectStarSelect(!1),this.scorePreLabel.node.active=!1,this.touchStar(e,t));else{if(0==this.gridData[e][t])return;this.stVar.connectStars=[[e,t]],this.checkStar(e,t),this.stVar.connectStars.length>=2&&(this.setConnectStarSelect(!0),this.scorePreLabel.string=i.calcClearScore(this.stVar.connectStars.length),this.scorePreLabel.node.stopAllActions(),this.scorePreLabel.node.setPosition(this.gridStarUi[e][t].position),this.scorePreLabel.node.opacity=255,this.scorePreLabel.fontSize=32,this.scorePreLabel.node.active=!0)}},checkStar:function(e,t){for(var r=this.gridData[e][t],c=[[e+1,t],[e-1,t],[e,t-1],[e,t+1]],i=c.length-1;i>=0;i--){c[i];var o=c[i][0],n=c[i][1];this.inGrid(o,n)&&this.gridData[o][n]==r&&!this.connectContain(o,n)&&(this.stVar.connectStars[this.stVar.connectStars.length]=[o,n],this.checkStar(o,n))}},inGrid:function(e,t){return e>=0&&e<i.gridSize&&t>=0&&t<i.gridSize},connectContain:function(e,t){for(var r=this.stVar.connectStars.length-1;r>=0;r--){var c=this.stVar.connectStars[r];if(c[0]==e&&c[1]==t)return!0}return!1},setConnectStarSelect:function(e){for(var t=this.stVar.connectStars.length-1;t>=0;t--){var r=this.stVar.connectStars[t];this.gridStarUi[r[0]][r[1]].getComponent(c).setSelected(e)}this.stVar.selected=e},cleanOnce:function(){if(this.scorePreLabel.fontSize=64,this.scorePreLabel.node.runAction(cc.sequence(cc.moveBy(.2,cc.p(0,20)),cc.delayTime(.8),cc.spawn(cc.moveBy(.2,cc.p(0,10)),cc.fadeOut(.2)))),this.totalScore+=parseInt(this.scorePreLabel.string),this.scoreLabel.string=this.totalScore,this.clearConnectStar(),this.fallDownStar(),this.fallLeftStar(),this.checkOver()){console.log("不能再消除了");var e=i.levelScores[i.currentLevel.toString()];(!e||this.totalScore>e)&&(console.log("破记录了"),i.setLevelScore(i.currentLevel,this.totalScore),i.saveLevelScores(),i.calcScoreLogic()),i.confirm("不能再消除了","您的得分:"+this.totalScore,"回主界面",function(){cc.director.loadScene("MainScene")})}},clearConnectStar:function(){for(var e=this.stVar.connectStars.length-1;e>=0;e--){var t=this.stVar.connectStars[e];this.gridData[t[0]][t[1]]=0,this.gridStarUi[t[0]][t[1]].destroy()}},fallDownStar:function(){for(var e=0;e<i.gridSize;e++)for(var t=0,r=0;r<i.gridSize;r++)0==this.gridData[e][r]&&t++,t>0&&this.gridData[e][r]>0&&(this.gridData[e][r-t]=this.gridData[e][r],this.gridData[e][r]=0,this.gridStarUi[e][r].getComponent(c).goTo(e,r-t,0),this.gridStarUi[e][r-t]=this.gridStarUi[e][r],this.gridStarUi[e][r]=null)},fallLeftStar:function(){for(var e=0,t=0;t<i.gridSize;t++)if(0==this.gridData[t][0]&&e++,0!=this.gridData[t][0]&&0!=e)for(var r=0;r<i.gridSize&&this.gridData[t][r]>0;r++)this.gridData[t-e][r]=this.gridData[t][r],this.gridData[t][r]=0,this.gridStarUi[t][r].getComponent(c).goTo(t-e,r,.1),this.gridStarUi[t-e][r]=this.gridStarUi[t][r],this.gridStarUi[t][r]=null},checkOver:function(){for(var e=0;e<i.gridSize;e++)for(var t=0;t<i.gridSize;t++){var r=this.gridData[e][t];if(0==r)break;for(var c=[[e+1,t],[e-1,t],[e,t-1],[e,t+1]],o=0;o<c.length;o++){var n=c[o][0],a=c[o][1];if(this.inGrid(n,a)&&this.gridData[n][a]==r)return!1}}return!0}}),cc._RF.pop()},{"../Comm.js":"Comm","../prefab/StarPrefab.js":"StarPrefab"}],LevelCurPrefab:[function(e,t,r){"use strict";cc._RF.push(t,"046c9RjCshG748pEaUzb9At","LevelCurPrefab");var c=e("../Comm.js");cc.Class({"extends":cc.Component,properties:{strLabel:cc.Label},setLevel:function(e){this.level=e;var t=c.levelScores[e.toString()];t||(t=0),this.strLabel.string="第"+e+"关 "+t+"分"},mainButtonClick:function(){this.cb(this.level)},setClickCallback:function(e){this.cb=e}}),cc._RF.pop()},{"../Comm.js":"Comm"}],LevelPrefab:[function(e,t,r){"use strict";cc._RF.push(t,"5c0b0KWY05MQIxdXOuvrjyk","LevelPrefab");var c=e("../Comm.js");cc.Class({"extends":cc.Component,properties:{strLabel:cc.Label},setLevel:function(e){this.level=e;var t=c.levelScores[e.toString()];t||(t=0),this.strLabel.string="第"+e+"关 "+t+"分"},setUnlockInfoForLevel:function(e){this.level=e,this.strLabel.string="总分"+c.calcTargetScore(this.level-1)+"解锁第"+e+"关"},mainButtonClick:function(){this.cb(this.level)},setClickCallback:function(e){this.cb=e}}),cc._RF.pop()},{"../Comm.js":"Comm"}],MainScene:[function(e,t,r){"use strict";cc._RF.push(t,"04fb30nHQBA7J6o6i9uMytG","MainScene");var c=e("../Comm.js"),i=e("../prefab/LevelPrefab.js"),o=e("../prefab/LevelCurPrefab.js");cc.Class({"extends":cc.Component,properties:{levelLayout:cc.Node,levelPrefab:cc.Prefab,levelCurPrefab:cc.Prefab,totalScoreLabel:cc.Label},onLoad:function(){c.readLevelScores(),c.calcScoreLogic(),this.totalScoreLabel.string="总分:"+c.totalScore;for(var e=1;e<c.minScoreLevel;e++){var t=cc.instantiate(this.levelPrefab);t.getComponent(i).setLevel(e),t.getComponent(i).setClickCallback(function(e){c.currentLevel=e,console.log("Comm.currentLevel",c.currentLevel),cc.director.loadScene("GameScene")}),this.levelLayout.addChild(t)}var t=cc.instantiate(this.levelCurPrefab);t.getComponent(o).setLevel(c.minScoreLevel),t.getComponent(o).setClickCallback(function(e){c.currentLevel=c.minScoreLevel,console.log("Comm.currentLevel",c.currentLevel),cc.director.loadScene("GameScene")}),this.levelLayout.addChild(t);for(var e=c.minScoreLevel+1;e<=c.maxLevel;e++){var t=cc.instantiate(this.levelPrefab);t.getComponent(i).setLevel(e),t.getComponent(i).setClickCallback(function(e){c.currentLevel=e,console.log("Comm.currentLevel",c.currentLevel),cc.director.loadScene("GameScene")}),this.levelLayout.addChild(t)}var t=cc.instantiate(this.levelPrefab);t.getComponent(i).setUnlockInfoForLevel(c.maxLevel+1),t.getComponent(i).setClickCallback(function(e){c.tip("总分达到"+c.calcTargetScore(e-1)+"才能玩这一关")}),this.levelLayout.addChild(t)},startButtonClick:function(){cc.director.loadScene("GameScene")}}),cc._RF.pop()},{"../Comm.js":"Comm","../prefab/LevelCurPrefab.js":"LevelCurPrefab","../prefab/LevelPrefab.js":"LevelPrefab"}],StarPrefab:[function(e,t,r){"use strict";cc._RF.push(t,"22bb0VNWAxF/ZMJwZXVIaIx","StarPrefab"),cc.Class({"extends":cc.Component,properties:{pic1:cc.SpriteFrame,pic2:cc.SpriteFrame,pic3:cc.SpriteFrame,pic4:cc.SpriteFrame,pic5:cc.SpriteFrame},onLoad:function(){this.node.setScale(1.17)},setType:function(e){this.starType=e,this.getComponent(cc.Sprite).spriteFrame=this["pic"+e]},setGridXY:function(e,t){this.gridX=e,this.gridY=t,this.node.setPosition(75*(e-5)+37.5,75*(t-5)+37.5)},setSelected:function(e){e?this.node.runAction(cc.repeatForever(cc.sequence(cc.scaleTo(.3,1),cc.scaleTo(.3,1.17)))):(this.node.stopAllActions(),this.node.setScale(1.17))},goTo:function(e,t,r){this.gridX=e,this.gridY=t,this.node.runAction(cc.sequence(cc.delayTime(r),cc.moveTo(.1,cc.p(75*(e-5)+37.5,75*(t-5)+37.5))))}}),cc._RF.pop()},{}],TipPrefab:[function(e,t,r){"use strict";cc._RF.push(t,"2fc39ba/flCCaXZ48+4ZaMH","TipPrefab"),cc.Class({"extends":cc.Component,properties:{tipLabel:cc.Label,tipBg:cc.Node},show:function(e){var t=this;this.tipLabel.string=e,this.node.setPosition(cc.director.getWinSize().width/2,100),this.node.runAction(cc.sequence(cc.delayTime(2),cc.fadeOut(.3),cc.callFunc(function(){t.node.destroy()})))}}),cc._RF.pop()},{}]},{},["Comm","ConfirmDialogPrefab","LevelCurPrefab","LevelPrefab","StarPrefab","TipPrefab","GameScene","MainScene"]);